<!doctype html>
<html>
	<head>
		<title>Chess</title>
		<style type="text/css">
		</style>
	</head>
	<body>

		<script src="bower_components/pathfinding/pathfinding-browser.min.js"></script>
		<script src="bower_components/phaser/build/phaser.min.js"></script>
		<script src="bower_components/jquery/dist/jquery.js"></script>
		<script type="text/javascript">
		var findPath, matrix;

		$(document).ready(function(){
			/*
			* -----------------------------
			*      CHESS PATHFINDING
			* -----------------------------
			*/
			var getChessNeighbors = function(node, diagonalMovement) {
			    var nodes = this.nodes;
			    var explore;
			    var curx = node.x, cury = node.y;
			    var possibleMoves = [];
			    var piece = this.piece;
			    var findMove = function(dx,dy, grid){
			      var x = curx+dx, y = cury+dy;
			      while(grid.isWalkableAt(x, y)){
			        possibleMoves.push(nodes[y][x]);
			        if(explore.single){break}
			        x += dx;
			        y += dy;
			      }
			    }
			    if(piece==='rook'){
			      explore=[[0,1],[1,0],[0,-1],[-1,0]];
			    } else if (piece==='bishop'){
			      explore=[[1,1],[1,-1],[-1,1],[-1,-1]];
			    } else if (piece==='knight'){
			      explore=[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]];
			      explore.single = true;
			    } else if (piece==='king'||piece==='queen'){
			      explore=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[1,-1],[-1,-1],[-1,1]];
			      if(piece==='king') explore.single = true;
			    }
			    for(var i = 0; i < explore.length; i++){
			      var dx,dy;
			      dx=explore[i][0];
			      dy=explore[i][1];
			      findMove(dx,dy, this);
			    }
			
			    return possibleMoves;
			};

			//chess board?!
			matrix = [
			    [0, 0, 0, 1, 0, 0, 1, 0],
			    [1, 0, 0, 0, 1, 0, 1, 0],
			    [0, 0, 0, 0, 0, 0, 1, 0],
			    [1, 0, 0, 0, 1, 0, 1, 0],
			    [0, 0, 1, 0, 0, 0, 1, 0],
			    [0, 0, 0, 1, 0, 0, 1, 0],
			    [1, 0, 0, 0, 1, 0, 1, 0],
			    [0, 0, 1, 0, 0, 0, 1, 0],
			];
			var grid = new PF.Grid(matrix);
			
			var finder = new PF.AStarFinder({
				heuristic: function(x,y){
					return 0.1*(x+y);//Lower number means better paths, worse performace.
				}
			});


			findPath = function(x1,y1,x2,y2,piece){
				var chessGrid = grid.clone();
				chessGrid.piece = piece;
				chessGrid.getNeighbors = getChessNeighbors;
				var path = finder.findPath(x1, y1, x2, y2, chessGrid);

				return path;
			}

			findPath(1,7,5,6,"knight");

			console.log('findPath(x1,y1,x2,y2,"[piece_type]");');


			/*
			* -----------------
			*      PHASER
			* -----------------
			*/


			var map, layer1;

			var preload = function() {
			    game.load.image('ground', 'assets/ground.png');
			}

			var create = function(){
				map = game.add.tilemap();
				map.tileWidth = 64;
				map.tileHeight = 64;
				map.addTilesetImage('ground');

				layer1 = map.create('level1', matrix.length,matrix.length,64,64);
				layer1.resizeWorld();

				for(var y = 0; y<matrix.length; y++){
					for(var x = 0; x < matrix[y].length; x++){
						map.putTile(matrix[y][x], x, y, layer1);
					}
				}
			}

			var update = function(){

			}

			var render = function(){

			}

			var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'chess', { preload: preload, create: create, update: update, render: render });
		})
		</script>
	</body>
</html>